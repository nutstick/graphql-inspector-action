{"version":3,"file":"suppress-removal-of-deprecated-field.js","sourceRoot":"","sources":["../../../src/diff/rules/suppress-removal-of-deprecated-field.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,mCAAsD;AAEtD,8CAAiE;AAEjE,uCAAyC;AAE5B,QAAA,gCAAgC,GAAS,UAAC,EAGtD;QAFC,oBAAO,EACP,wBAAS;IAET,OAAO,OAAO,CAAC,GAAG,CAAC,UAAA,MAAM;QACvB,IACE,MAAM,CAAC,IAAI,KAAK,mBAAU,CAAC,YAAY;YACvC,MAAM,CAAC,WAAW,CAAC,KAAK,KAAK,yBAAgB,CAAC,QAAQ;YACtD,MAAM,CAAC,IAAI,EACX;YACM,IAAA,kCAA8C,EAA7C,gBAAQ,EAAE,iBAAmC,CAAC;YACrD,IAAM,IAAI,GAAG,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAEzC,IAAI,sBAAY,CAAC,IAAI,CAAC,IAAI,yBAAe,CAAC,IAAI,CAAC,EAAE;gBAC/C,IAAM,KAAK,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,SAAS,CAAC,CAAC;gBAE1C,IAAI,KAAK,CAAC,YAAY,EAAE;oBACtB,6BACK,MAAM,KACT,WAAW,wBACN,MAAM,CAAC,WAAW,KACrB,KAAK,EAAE,yBAAgB,CAAC,SAAS,OAEnC;iBACH;aACF;SACF;QAED,OAAO,MAAM,CAAC;IAChB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import {isObjectType, isInterfaceType} from 'graphql';\n\nimport {CriticalityLevel, ChangeType} from './../changes/change';\nimport {Rule} from './types';\nimport {parsePath} from '../common/path';\n\nexport const suppressRemovalOfDeprecatedField: Rule = ({\n  changes,\n  oldSchema,\n}) => {\n  return changes.map(change => {\n    if (\n      change.type === ChangeType.FieldRemoved &&\n      change.criticality.level === CriticalityLevel.Breaking &&\n      change.path\n    ) {\n      const [typeName, fieldName] = parsePath(change.path);\n      const type = oldSchema.getType(typeName);\n\n      if (isObjectType(type) || isInterfaceType(type)) {\n        const field = type.getFields()[fieldName];\n\n        if (field.isDeprecated) {\n          return {\n            ...change,\n            criticality: {\n              ...change.criticality,\n              level: CriticalityLevel.Dangerous,\n            },\n          };\n        }\n      }\n    }\n\n    return change;\n  });\n};\n"]}